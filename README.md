# MIGI
MIGI是一个通过优化辐射缓存实现的实时全局光照技术，它使用八面体探针编码和参数化函数混合实现实时动态辐射缓存。

它基于 Capsaicin 构建，在几乎与 Lumen 相同的屏幕空间探针层次结构上运行。它使用了 GI1.1 中的二级哈希网格辐射缓存，以保持简单性。

MIGI的新颖之处在于它为传统的八面体探针编码增加了参数化函数，二者协同缓存不同频率的光照，从而实现了对辐射场的更高效和更准确的表示。

MIGI选用的参数化函数是一系列球面高斯函数的总和，与八面体探针协同工作，并在实时渲染中进行在线优化、重新投影和滤波。

与实时渲染中的传统缓存方案相比，使用球面高斯函数的关键优势在于它实现了“全频率缓存”。也就是说，不同于只能进行低频缓存的老方案，这套缓存没有关于入射辐射方向上分布的频率限制，高频低频光照都能表达。

以下是 SG 增强缓存和传统八面体探针缓存之间的区别。

这是在移动光源场景下 SG 增强缓存的表现。
<img src="migi_docs/moving-light-SG.gif" height="400px" width="600px">SG 增强缓存</img>

这是传统的八面体探针缓存。即使在能够稳定时域降噪的静态照明下，它会丢失高频率的光泽反射，并且渲染效果整体（由于SH积分时的近似变得）偏暗，且因为重要性采样的导引分布更粗糙而有着轻微更大的噪音。
<img src="migi_docs/no-SG.png" height="400px" width="600px">传统</img>
上图不是GIF，是单帧，因此看不出动态的噪音...截GIF的时候忘了截两个图了...

**注意：** 我们尚未实现任何特定的直接光算法。由于没有光样本，当前算法将所有发光物体都视为间接光源。因此，请将上面图片中的发光体视为间接光源。当前算法与针对具有光先验和光样本的直接照明进行优化的算法（ReSTIR/Manylights/LTC+Visibility）进行渲染质量的比较没有太大意义。

当前整个管线的实现其实尚未完全完工。它在 RTX 3090 上以 1080p 分辨率运行速度超过 130 帧，并且可缩放到更高质量（或在中低端硬件上以降低质量为代价获得更快速度）。
![Bedroom](migi_docs/track1.gif)
![Sponza](migi_docs/track2.gif)

由于时间不足，当前实现中还有一些未解决的问题。

* 多个球面高斯优化。之前的大量尝试大多都失败了，所以我们决定暂时搁置它。
* 当前的 SG 重新投影方法不够稳定（会产生有点明显的噪点，你在上面的GIF中应该能看到少许）。
* 尚未探索和实现 SG 的空间滤波。
* 当前实现中存在多个影响渲染质量的Bug。我已经花了几周的时间来发现和解决这些问题，并且还没整完...

此外，使用球面高斯函数还有其他一些好处。 关于将 SG 光源与 Torrance-Sparrow BSDFs（GGX）进行积分的数值近似已经存在并且性能良好； 在入射光分布的复杂性变化时，可以缩放每个探针中的 SG 数量； 收集关于每个 SG 方向上几何形状的统计信息，可能对于快速更新和变化的照明提供明确的指导。

不过，这些只是我未来要探索的方向…
# 编译和运行
参照 [Capsaicin 的编译和运行说明](README_Capsaicin.md)，编译 MIGI。